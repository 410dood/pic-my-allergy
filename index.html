<html>
<h1>
	Pic My Allergy
</h1>
<head>
	<script type="text/javascript" src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
	<script type="text/javascript" src="https://cdn.rawgit.com/selectize/selectize.js/master/dist/js/standalone/selectize.js"></script>
	<link rel="stylesheet" type="text/css" href="https://cdn.rawgit.com/selectize/selectize.js/master/dist/css/selectize.css" />

</head>

<body>
	<p style='color: blue'>{{message}}</p>

	<div id="dangerFoods">
		<ul>
			{{#each danger}}
				<li>
					There is a <b>{{this.probability}}% </b> chance that the image has <b> {{this.food}}. </b>
				</li>
			{{/each}}
		</ul>
	</div>

	<form action='allergy'>

		<label> Allergies </label>
		<br><br>
		<select id="sel" name="sel" multiple>
			{{#each foods}}
				<option value="{{this.foods}}">{{this.foods}}</option>

			{{/each}}
		</select>
		<br>
		<input type='submit' value='Create & Save'>

		<br><br><br><br>
		<h3> My allergies </h3>
		<p style='color: red'> {{atleast1}} </p>

		<div id="myAllergies">
			<ul>
				{{#each allergies}}
					<li>
						{{this.allergies}}
					</li>
				{{/each}}
			</ul>
		</div>

	</form>

	<form action='reset'>
		<input type='submit' value='Clear'>
	</form>
	
	<br>

	<form id="amIAllergic" action='amIAllergic'>
	<!-- <form id="amIAllergic">  -->
		<p> Please enter an image URL: </p>
		<p style='color: red'>{{badImage}}</p>
		<input type="url" name="url" id="url"><br><br>
		<img id="imgPreview" />

		<br><br>
		<script>
	        $(document).ready(function(){
	        	$('#url').change(function() {
	        		var cleanURL = $('#url').val();

	        		// if URL contains a query string
	        		if(cleanURL.indexOf('?') > -1) {
	        			var cleanURL = $('#url').val().substring(0, $('#url').val().indexOf("?"));
	        		}

	        		// if valid image URL
	        		if (cleanURL.match(/(jpeg|jpg|gif|png)$/)) {
	        			$('#imgPreview').attr('src', $('#url').val());
	        			$('#imgPreview').attr('style', 'max-width: 300; max-height: 300');
	        		}
	        		else {
	        			$('#imgPreview').attr('src', null);
	        		}
	        	});
	        });
    	</script>
		<input type="submit" value="Am I allergic?">

	<!-- Make url allergies work first -->

	</form>

	<script>

		$(function() {
			$('select').selectize({});
		});

	</script>


</body>
</html>