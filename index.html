<html>
<title>
	Pic My Allergy
</title>
<head>
	<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
	<script type="text/javascript" src="https://cdn.rawgit.com/mattyork/fuzzy/master/lib/fuzzy.js"></script>
	<form action='allergy'>
		<!--
		List your allergies (separated by commas): 
		<br>
		Ex: tomatoes, eggs, peanuts
		<br><br>
		 <textarea type='text' name="allergies"></textarea> -->
		<br>

		<!--get a list of all the food items in clarifai food model api
			store it in JSON file
			display these in a drop-down, that shows 6 choices at a time, scrollable
			selecting the drop down and clicking 'add' should add it to allergies JSON file

		--> 
			
		<script type="text/javascript">
			var foods = [ 
			"potato",
			"tomatoes",
			"spinach",
			"teriyaki",
			"chicken"
			];

			function listFood() {
				var search = $('#search').val();
				console.log("Search: " + search);

				var options = {
					pre: "<b>",
					post: "</b>"
				}
				var filtered = fuzzy.filter(search, foods, options);

				// process the results to extract the strings
				var newFood = filtered.map(function(el) {
					return '<li>' + el.string + '</li>';
				});

				$('#foods').html(newFood.join(''));
			}

			$(function() {
		      // List the initial characters
		      listFood();

		      // Filter the characters on each change of the textbox
		      $('#search').keyup(function() {
		      	listFood();
		      	console.log("TYPING...");

		      });

		    });

		</script>

		<style>
			b {
				color: blue;
			}
		</style>
	</head>

	<body>
		<h2> Search food items </h2>
		<input type="text" id="search" class="search"></input>
		<ul id="foods">
		</ul>

		<!-- <input type='submit' value='Submit'> -->
	</form>
	<br>

	<form action='reset'>
		<h3> My allergies </h3>
		<ul>
			<!-- separate them based on commas -->
			{{#each allergies}} <!-- syntax for for loop -->
				<li>
					{{this.allergies}}
				</li>
			{{/each}}
		</ul>
		<input type='submit' value='Clear'>
	</form>
	<br>

	<form id='frmUploader' action='upload' method='post' enctype="multipart/form-data">
		<h3> Upload your image here </h3>
		<input id="the-file-input" type='file' name="imgUploader" onchange="renderImage(this.files[0])"> 
		<p id="preview"></p>
		<script>
			function renderImage (file) { // using HTML5 File API which reduces load on the server
				var reader = new FileReader();

				reader.onload = function(event) {
					the_url = event.target.result;
					console.log("the_url: " + the_url);
					$('#preview').html("Preview: <br><br><img src='" + the_url + "'" + "style='max-width:175px;max-length:175px' />");
				}

				console.log("file: " + file);

				reader.readAsDataURL(file);
			}
		</script>
		<br><br>
		<input id="upload" type='submit' value='Upload' onchange="renderImage(this.files[0])">
	</form>

	<form id="amIAllergic" action='amIAllergic' method='post'>
		<input type="submit" value="Am I allergic?">
	</form>
</body>
</html>